"use strict";require("core-js/stable"),require("regenerator-runtime/runtime"),function(){var a,i,u,c,d=document.getElementById("panel"),t=document.getElementById("resetBtn"),l=document.getElementById("step"),v=60,f=8,m=8,s=9,h=4,o=h*h,r=[],p=Array(o).fill(0);function x(e){for(var t=0<arguments.length&&void 0!==e?e:1;0<t--;)!function(e){var t;for(;t=Math.floor(Math.random()*o),0!==p[t];);p[t]=e;var n=document.createElement("div");n.id="block-".concat(t),n.className="block block-".concat(e),n.innerText=e,n.style.top=r[t].top+"px",n.style.left=r[t].left+"px",d.appendChild(n)}(.5<Math.random()?4:2)}function g(){d.innerHTML="",l.innerText=0,p=p.map(function(){return 0}),x(2)}!function(){for(var e=0;e<o;e++)r[e]={top:s+Math.floor(e/h)*(v+f),left:m+e%h*(v+f)};x(2),t.onclick=g,d.addEventListener("touchstart",function(e){a=e.targetTouches[0].pageX,i=e.targetTouches[0].pageY},!1),d.addEventListener("touchmove",function(e){1<e.targetTouches.length||e.scale&&1!==e.scale||(u=e.targetTouches[0].pageX,c=e.targetTouches[0].pageY)},!1),d.addEventListener("touchend",function(){var e,t,n,o,r;u&&c&&((e=Math.abs(a-u))===(t=Math.abs(i-c))||Math.max(e,t)<50||(o=function(i){for(var u=!1,e=function(n){var e=p.map(function(e,t){return{value:e,index:t}}),t=void 0,t="top"===i||"down"===i?e.filter(function(e,t){return(t-n)%h==0}):e.filter(function(e,t){return n*h<=t&&t<(n+1)*h});"down"!==i&&"right"!==i||t.reverse();for(var o=t.findIndex(function(e){return 0<e.value}),r=void 0;-1<o&&o<h-1;){var a=t.slice(o+1,h).findIndex(function(e){return 0<e.value});if(!(-1<a))break;if(r=a+o+1,t[o].value===t[r].value){if(!function(e,t){e.value*=2,t.value=0,p[e.index]*=2,p[t.index]=0;var n=document.getElementById("block-"+e.index);n.innerText=e.value,n.className="block block-".concat(e.value),d.removeChild(document.getElementById("block-"+t.index))}(t[o],t[r]),u=!0,r===h-1)break;o=r+1}else o=r}},t=0;t<h;t++)e(t);return u}(n=e<t?i<c?"down":"top":a<u?"right":"left"),r=function(r){for(var a=!1,e=function(n){var e=p.map(function(e,t){return{value:e,index:t,moveCount:0,moveToId:-1}}),t=void 0,t="top"===r||"down"===r?e.filter(function(e,t){return(t-n)%h==0}):e.filter(function(e,t){return n*h<=t&&t<(n+1)*h});"down"!==r&&"right"!==r||t.reverse();for(var o=0;o<h;o++)if(1<o&&(t[o].moveCount+=t[o-1].moveCount),0===t[o].value&&o<h-1&&t[o+1].moveCount++,0<o&&0<t[o].moveCount&&0<t[o].value){switch(r){case"top":t[o].moveToId=t[o].index-h*t[o].moveCount;break;case"down":t[o].moveToId=t[o].index+h*t[o].moveCount;break;case"left":t[o].moveToId=t[o].index-t[o].moveCount;break;case"right":t[o].moveToId=t[o].index+t[o].moveCount}p[t[o].moveToId]=t[o].value,p[t[o].index]=0,function(e,t){var n=document.getElementById("block-"+e.index);"top"===t||"down"===t?n.style.top=s+Math.floor(e.moveToId/h)*(v+f)+"px":n.style.left=m+e.moveToId%h*(v+f)+"px";n.id="block-"+e.moveToId}(t[o],r),a=!0}},t=0;t<h;t++)e(t);return a}(n),(o||r)&&(l.innerText=parseInt(l.innerText)+1,setTimeout(function(){return p.includes(2048)?(alert("划了".concat(l.innerText,"下终于赢了，好累啊~")),void g()):(x(),void setTimeout(function(){if(!p.includes(0)){for(var e=0;e<p.length;e++)if(p[e]===p[e+1]||p[e]===p[e-1]||p[e]===p[e+h]||p[e]===p[e-h])return;alert("game over"),g()}},100))},100))))},!1)}()}();